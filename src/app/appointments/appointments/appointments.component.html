<div class="head">
  <h2>Appointments</h2>
  <button mat-raised-button class="gradient" (click)="openCreate()">+ Schedule Appointment</button>
</div>

<mat-form-field appearance="outline" class="search">
  <mat-label>Search by patient, doctor, or specialization</mat-label>
  <input matInput [(ngModel)]="q">
</mat-form-field>

<div class="cards">
  <app-appointment-card
    *ngFor="let a of filtered()"
    [data]="a"
    (view)="onView($event)"
    (edit)="openEdit($event)"
  ></app-appointment-card>
</div>

<!-- Use a template reference for the dialog -->
<dialog #dlg>
  <form [formGroup]="form" (ngSubmit)="save()">
    <h3>{{editing() ? 'Edit' : 'Schedule'}} Appointment</h3>

    <div class="grid">
      <mat-form-field appearance="outline">
        <mat-label>Patient</mat-label>
        <input matInput formControlName="patient">
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Doctor</mat-label>
        <input matInput formControlName="doctor">
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Specialization</mat-label>
        <mat-select formControlName="specialization">
          <mat-option *ngFor="let s of specs" [value]="s">{{s}}</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Date (yyyy-mm-dd)</mat-label>
        <input matInput formControlName="date" placeholder="2025-01-20">
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Time (HH:mm)</mat-label>
        <input matInput formControlName="time" placeholder="10:00">
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Duration (min)</mat-label>
        <input type="number" matInput formControlName="durationMin">
      </mat-form-field>

      <mat-form-field appearance="outline" class="full">
        <mat-label>Room</mat-label>
        <input matInput formControlName="room">
      </mat-form-field>

      <mat-form-field appearance="outline" class="full">
        <mat-label>Notes</mat-label>
        <input matInput formControlName="notes">
      </mat-form-field>
    </div>

    <div class="actions">
      <button mat-stroked-button type="button" (click)="dlg.close()">Cancel</button>
      <button mat-raised-button color="primary" type="submit">{{editing() ? 'Update' : 'Create'}}</button>
    </div>
  </form>
</dialog>
